# MIT License
#
# (C) Copyright [2022] Hewlett Packard Enterprise Development LP
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included
# in all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
# OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
# ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
# OTHER DEALINGS IN THE SOFTWARE.

# Tavern test cases for the BSS bootparameters API
# Author: Ryan Sjostrand
# Service: Boot Script Service

---
test_name: bssAPIBootparameters

stages:
- name: Delete existing test bootparameters if it exists
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0

- name: Create Bootparameter with xname
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: POST
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
      params: console=tty0
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000000/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000000/initrd
  response:
    status_code: 201

- name: Ensure that the BSS bootparameters can be retrieved
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
              macs:
                type: seq
                sequence:
                - type: str
              nids:
                type: seq
                sequence:
                - type: int
              params:
                type: str
              kernel:
                type: str
              initrd:
                type: str
              cloud-init:
                type: map
                allowempty: true

- name: Delete testing bootparameters by xname
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
  response:
    status_code: 200  

- name: Delete testing bootparameters by kernel
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000000/kernel
  response:
    status_code: 200  

- name: Delete testing bootparameters by initrd
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000000/initrd
  response:
    status_code: 200  

---
test_name: bssAPIBootparameterXnameAsIdentifier

stages:
- name: Delete existing test bootparameters if it exists
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0

- name: Create Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: POST
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
      params: console=tty0
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000000/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000000/initrd
  response:
    status_code: 201
    headers:
      BSS-Referral-Token: !anystr

- name: Create duplicate Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: POST
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
      params: console=tty0
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000000/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000000/initrd
  response:
    status_code: 400
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: map
          required: True
          mapping:
            type:
              type: str
              required: True
            title:
              type: str
              required: True
            detail:
              type: str
              required: False
            instance:
              type: str
              required: False
            status:
              type: int
              required: False

- name: Retrieve created Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters?name=x9999c0s1b0n0"
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s1b0n0
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000000/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000000/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Replace Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: PUT
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
      params: console=tty0 console=ttyS0,115200
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000001/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000001/initrd
  response:
    status_code: 200
    headers:
      BSS-Referral-Token: !anystr

- name: Retrieve replaced Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters?name=x9999c0s1b0n0"
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s1b0n0
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 console=ttyS0,115200
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000001/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000001/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Update Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: PATCH
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000002/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000002/initrd
  response:
    status_code: 200

- name: Retrieve replaced Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters?name=x9999c0s1b0n0"
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s1b0n0
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 console=ttyS0,115200
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000002/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000002/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Delete Bootparameters with xname as host
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
  response:
    status_code: 200

- name: Retrieve deleted Bootparameters with xname specified as identifier
  request:
    url: "{bss_base_url}/boot/v1/bootparameters?name=x9999c0s1b0n0"
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 404
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: map
          required: True
          mapping:
            type:
              type: str
              required: True
            title:
              type: str
              required: True
            detail:
              type: str
              required: False
            instance:
              type: str
              required: False
            status:
              type: int
              required: False

- name: Delete Bootparameters with xname as host
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s1b0n0
  response:
    status_code: 400
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: map
          required: True
          mapping:
            type:
              type: str
              required: True
            title:
              type: str
              required: True
            detail:
              type: str
              required: False
            instance:
              type: str
              required: False
            status:
              type: int
              required: False

---
test_name: bssAPIBootparameterMultipleHosts

stages:
- name: Delete existing test bootparameters if it exists
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: DELETE
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s6b0n0
      - x9999c0s6b0n1
      - x9999c0s6b0n2

- name: Create Bootparameters with multiple hosts x9999c0s6b0n[0,1]
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: POST
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s6b0n0
      - x9999c0s6b0n1
      params: console=tty0
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
  response:
    status_code: 201
    headers:
      BSS-Referral-Token: !anystr

- name: Verify bootparameter for x9999c0s6b0n0 was created
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n0
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n0
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Verify bootparameter for x9999c0s6b0n1 was created
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n1
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n1
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Update bootparameter for only x9999c0s6b0n1
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: PATCH
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s6b0n1
      params: console=tty0 updated
  response:
    status_code: 200

- name: Verify bootparameter for x9999c0s6b0n0 remains unchanged
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n0
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n0
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Verify bootparameter for x9999c0s6b0n1 was updated
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n1
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n1
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 updated
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Replace bootparameters with multiple hosts x9999c0s6b0n[0,1] 
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: PUT
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s6b0n0
      - x9999c0s6b0n1
      params: console=tty0 replaced
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
  response:
    status_code: 200
    headers:
      BSS-Referral-Token: !anystr

- name: Verify bootparameter for x9999c0s6b0n0 was updated
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n0
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n0
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 replaced
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Verify bootparameter for x9999c0s6b0n1 was updated
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n1
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n1
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 replaced
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Create and replace bootparamaters with multiple hosts x9999c0s6b0n[1, 2]
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    method: PUT
    verify: !bool "{verify}"
    json:
      hosts:
      - x9999c0s6b0n1
      - x9999c0s6b0n2
      params: console=tty0 create_replaced
      kernel: s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
      initrd: s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
  response:
    status_code: 200
    headers:
      BSS-Referral-Token: !anystr

- name: Verify bootparameter for x9999c0s6b0n0 was unchanged
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n0
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n0
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 replaced
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Verify bootparameter for x9999c0s6b0n1 was updated
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n1
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n1
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 create_replaced
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""

- name: Verify bootparameter for x9999c0s6b0n2 was created
  request:
    url: "{bss_base_url}/boot/v1/bootparameters"
    params:
      name: x9999c0s6b0n2
    method: GET
    verify: !bool "{verify}"
  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: seq
          range:
            max: 1
          matching: all
          sequence:
          - type: map
            mapping:
              hosts:
                type: seq
                sequence:
                - type: str
                  enum:
                  - x9999c0s6b0n2
              macs:
                type: seq
                range:
                  max: 0
                sequence:
                - type: str
              nids:
                type: seq
                range:
                  max: 0
                sequence:
                - type: int
              params:
                type: str
                enum: 
                - console=tty0 create_replaced
              kernel:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/kernel
              initrd:
                type: str
                enum:
                - s3://boot-images/00000000-0000-0000-0000-000000000003/initrd
              cloud-init:
                type: map
                allowempty: true
                mapping:
                  meta-data:
                    type: none
                  user-data:
                    type: none
                  phone-home:
                    type: map
                    mapping:
                      pub_key_dsa:
                        type: str
                        enum:
                        - ""
                      pub_key_rsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ecdsa:
                        type: str
                        enum:
                        - ""
                      pub_key_ed25519:
                        type: str
                        enum:
                        - ""
                      instance_id:
                        type: str
                        enum:
                        - ""
                      hostname:
                        type: str
                        enum:
                        - ""
                      fqdn:
                        type: str
                        enum:
                        - ""
